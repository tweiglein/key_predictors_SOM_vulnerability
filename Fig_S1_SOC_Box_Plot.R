# File Header -------------------------------------------------------------

# File Name: Fig_S1_SOC_Box_Plot
# Created: April 07, 2021 by Tyler Weiglein
# Last Modified: October 28, 2021 by Tyler Weiglein

# Purpose: To generate Figure S1 (SOC box plot) for Supplementary Information 
# section.


# Preliminaries -----------------------------------------------------------

# Clear console and environment

cat("\014") 

rm(list = ls(all.names = TRUE))

# Load package(s)

library(lawstat)
library(tidyverse)

# Set working directory

setwd("*Insert working directory path here*")

# Read in CSR data

data <- read.csv("data.csv")


# Hypothesis Testing ------------------------------------------------------

# Check assumptions - A horizons

qqnorm(subset(data, horizon_type %in% "A-Horizon")$OC.g100g_BULK,
       pch = 20,
       main = "Normal Q-Q Plot: A Horizon SOC")
qqline(subset(data, horizon_type %in% "A-Horizon")$OC.g100g_BULK,
       col = "red",
       lwd = 2)

# A horizon SOC values do not follow a normal distribution.

# Check assumptions - B Horizons

qqnorm(subset(data, horizon_type %in% "Upper B-Horizon")$OC.g100g_BULK,
       pch = 20,
       main = "Normal Q-Q Plot: B Horizon SOC")
qqline(subset(data, horizon_type %in% "Upper B-Horizon")$OC.g100g_BULK,
       col = "red",
       lwd = 2)

# B horizon SOC values do not follow  anormal distribution.

# Will have to use paired non-parametric test (e.g., Wilcoxon signed rank test)

# Test for equal variances

leveneTest(data$OC.g100g_BULK, group = data$horizon_type)

# Given that p = 0.0009994, equal variances assumption is NOT met.

SOC_test <- brunner.munzel.test(subset(data, horizon_type %in% "A-Horizon")$OC.g100g_BULK,
                                subset(data, horizon_type %in% "Upper B-Horizon")$OC.g100g_BULK)

print(SOC_test)

# Given that p = 5.281e-11, it can be concluded that the SOC values are stochastically different between the two types of horizons.


# Box Plot ----------------------------------------------------------------

# Create box plot

SOC_box_plot <- ggplot(data = data, aes(y = OC.g100g_BULK, fill = horizon_type)) +
  stat_boxplot(geom = "errorbar") +
  geom_boxplot() +
  ylab("Initial SOC (%)") + 
  scale_fill_discrete(name = "Horizon Type", labels = c("A Horizon", "B Horizon")) +
  geom_text(x = 0, y = 7.5, label = "p-value < 0.001 ", size = 6) +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title.y = element_text(face = "bold", size = 24, margin = margin(r = 0)),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_text(color = "black", size = 18),
        legend.title = element_text(face = "bold", size = 24),
        legend.text = element_text(size = 18),
        legend.box.background = element_rect(color = "black"),
        legend.justification = c(1, 1),
        legend.position = c(0.95, 0.95),
        aspect.ratio = 1)

