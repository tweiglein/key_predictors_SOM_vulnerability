# File Header -------------------------------------------------------------

# File Name: Fig_S5_CSR_v_Selected_Fe_Al_Proxies.R
# Created: April 05, 2021 by Tyler Weiglein
# Last Modified: October 28, 2021 by Tyler Weiglein

# Purpose: To create Figure S5 (plot of CSR versus selected reactive Fe and 
# Al proxies and compare fit R^2 values) for Supplementary Information section.


# Preliminaries -----------------------------------------------------------

# Clear console and environment

cat("\014") 
rm(list = ls(all.names = TRUE))

# Load package(s)

library(ggpubr)
library(mice)
library(tidyverse)

# Set working directory

setwd("*Insert working directory path here*")

# Read in mids objects corresponding to imputed predictor data sets

load("data_imp_CSR_0MST33_A_mids.RData")
load("data_imp_CSR_0MST33_B_mids.RData")

# Extract non-imputed data set (Note: Reactive Fe and Al predictors not imputed)

data_A <- complete(data_imp_CSR_0MST33_A_mids, 0)
data_B <- complete(data_imp_CSR_0MST33_B_mids, 0)

# Extract necessary data

cols_keep <- c("t52_cumul_spec_resp_ugC_per_gC",
               "SP_Fe.g100g_BULK",
               "AO_Fe.g100g_BULK",
               "AO_Al.g100g_BULK",
               "DC_Al.g100g_BULK")

cols_keep_names <- c("CSR_52wks_pct",
                     "SP_Fe.g100g",
                     "AO_Fe.g100g",
                     "AO_Al.g100g",
                     "DC_Al.g100g")

data_lm_A <- data_A[, cols_keep]
data_lm_B <- data_B[, cols_keep]

colnames(data_lm_A) <- cols_keep_names
colnames(data_lm_B) <- cols_keep_names

# Convert CSR to percentage initial SOC respired

data_lm_A$CSR_52wks_pct <- data_lm_A$CSR_52wks_pct/(10^4)
data_lm_B$CSR_52wks_pct <- data_lm_B$CSR_52wks_pct/(10^4)


# Fit SLR w/ lm -----------------------------------------------------------

# SP Fe

SP_Fe_lm_A <- lm(log(CSR_52wks_pct) ~ SP_Fe.g100g, data = data_lm_A)
SP_Fe_lm_B <- lm(log(CSR_52wks_pct) ~ SP_Fe.g100g, data = data_lm_B)

# AO Fe

AO_Fe_lm_A <- lm(log(CSR_52wks_pct) ~ log(AO_Fe.g100g), data = data_lm_A)
AO_Fe_lm_B <- lm(log(CSR_52wks_pct) ~ log(AO_Fe.g100g), data = data_lm_B)

# AO Al

AO_Al_lm_A <- lm(log(CSR_52wks_pct) ~ log(AO_Al.g100g), data = data_lm_A)
AO_Al_lm_B <- lm(log(CSR_52wks_pct) ~ log(AO_Al.g100g), data = data_lm_B)

# DC_Al

DC_Al_lm_A <- lm(log(CSR_52wks_pct) ~ log(DC_Al.g100g), data = data_lm_A)
DC_Al_lm_B <- lm(log(CSR_52wks_pct) ~ log(DC_Al.g100g), data = data_lm_B)


# Check Model Fits --------------------------------------------------------

# SP Fe

plot(SP_Fe_lm_A)
plot(SP_Fe_lm_B)

# AO Fe

plot(AO_Fe_lm_A)
plot(AO_Fe_lm_B)

# AO Al

plot(AO_Al_lm_A)
plot(AO_Al_lm_B)

# DC Al

plot(DC_Al_lm_A)
plot(DC_Al_lm_B)


# Plot Transformed Data and SLR Models ------------------------------------

gg_colors <- c("#F8766D", "#00BFC4")

axis_font_size <- 14
axis_label_font_size <- 16
title_font_size <- 16
R2_font_size <- 6

SP_Fe_plot <- ggplot() +
  geom_point(data = data_lm_A, aes(x = SP_Fe.g100g, y = log(CSR_52wks_pct), color = "1"), size = 3) +
  geom_point(data = data_lm_B, aes(x = SP_Fe.g100g, y = log(CSR_52wks_pct), color = "2"), size = 3) +
  geom_smooth(method = "lm", formula = y ~ x, data = data_lm_A, aes(x = SP_Fe.g100g, y = log(CSR_52wks_pct), color = "1")) +
  geom_smooth(method = "lm", formula = y ~ x, data = data_lm_B, aes(x = SP_Fe.g100g, y = log(CSR_52wks_pct), color = "2")) +
  annotate("text", x = 0.4, y = 3, label = paste0("'A Hor.:'~ R ^ 2 ~'='~", round(summary(SP_Fe_lm_A)$r.squared, 2)), size = R2_font_size, hjust = 0, parse = TRUE) +
  annotate("text", x = 0.4, y = 2.8, label = paste0("'B Hor.:'~ R ^ 2 ~'='~", round(summary(SP_Fe_lm_B)$r.squared, 2)), size = R2_font_size, hjust = 0, parse = TRUE) +
  scale_color_manual(name = "Horizon Type", values = gg_colors, labels = c("A Horizon", "B Horizon")) +
  labs(tag = "(a)",
       x = "Sodium Pyrophosphate Extractable Fe (g/100g)",
       y = "log(Cumul. Spec. Resp. (% SOC Respired))") +
  theme_bw() +
  theme(legend.title = element_text(face = "bold", size = axis_label_font_size),
        legend.text = element_text(color = "black", size = axis_font_size),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        plot.title = element_text(face = "bold", size = title_font_size),
        axis.title.x = element_text(face = "bold", size = axis_label_font_size),
        axis.title.y = element_text(face = "bold", size = axis_label_font_size),
        axis.text.x = element_text(color = "black", size = axis_font_size),
        axis.text.y = element_text(color = "black", size = axis_font_size),
        legend.margin = margin(0, 24, 0, 24),
        aspect.ratio = 1)
  
AO_Fe_plot <- ggplot() +
  geom_point(data = data_lm_A, aes(x = log(AO_Fe.g100g), y = log(CSR_52wks_pct), color = "1"), size = 3) +
  geom_point(data = data_lm_B, aes(x = log(AO_Fe.g100g), y = log(CSR_52wks_pct), color = "2"), size = 3) +
  geom_smooth(method = "lm", formula = y ~ x, data = data_lm_A, aes(x = log(AO_Fe.g100g), y = log(CSR_52wks_pct), color = "1")) +
  geom_smooth(method = "lm", formula = y ~ x, data = data_lm_B, aes(x = log(AO_Fe.g100g), y = log(CSR_52wks_pct), color = "2")) +
  annotate("text", x = -4, y = 1, label = paste0("'A Hor.:'~ R ^ 2 ~'='~", round(summary(AO_Fe_lm_A)$r.squared, 2)), size = R2_font_size, hjust = 0, parse = TRUE) +
  annotate("text", x = -4, y = 0.8, label = paste0("'B Hor.:'~ R ^ 2 ~'='~", round(summary(AO_Fe_lm_B)$r.squared, 2)), size = R2_font_size, hjust = 0, parse = TRUE) +
  scale_color_manual(name = "Horizon Type", values = gg_colors, labels = c("A Horizon", "B Horizon")) +
  labs(tag = "(b)",
       x = "log(Ammonium Oxalate Extractable Fe (g/100g))",
       y = "log(Cumul. Spec. Resp. (% SOC Respired))") +
  theme_bw() +
  theme(legend.title = element_text(face = "bold", size = axis_label_font_size),
        legend.text = element_text(color = "black", size = axis_font_size),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        plot.title = element_text(face = "bold", size = title_font_size),
        axis.title.x = element_text(face = "bold", size = axis_label_font_size),
        axis.title.y = element_text(face = "bold", size = axis_label_font_size),
        axis.text.x = element_text(color = "black", size = axis_font_size),
        axis.text.y = element_text(color = "black", size = axis_font_size),
        legend.margin = margin(0, 24, 0, 24),
        aspect.ratio = 1)
  
AO_Al_plot <- ggplot() +
  geom_point(data = data_lm_A, aes(x = log(AO_Al.g100g), y = log(CSR_52wks_pct), color = "1"), size = 3) +
  geom_point(data = data_lm_B, aes(x = log(AO_Al.g100g), y = log(CSR_52wks_pct), color = "2"), size = 3) +
  geom_smooth(method = "lm", formula = y ~ x, data = data_lm_A, aes(x = log(AO_Al.g100g), y = log(CSR_52wks_pct), color = "1")) +
  geom_smooth(method = "lm", formula = y ~ x, data = data_lm_B, aes(x = log(AO_Al.g100g), y = log(CSR_52wks_pct), color = "2")) +
  annotate("text", x = -4.2, y = 1, label = paste0("'A Hor.:'~ R ^ 2 ~'='~", round(summary(AO_Al_lm_A)$r.squared, 2)), size = R2_font_size, hjust = 0, parse = TRUE) +
  annotate("text", x = -4.2, y = 0.8, label = paste0("'B Hor.:'~ R ^ 2 ~'='~", round(summary(AO_Al_lm_B)$r.squared, 2)), size = R2_font_size, hjust = 0, parse = TRUE) +
  scale_color_manual(name = "Horizon Type", values = gg_colors, labels = c("A Horizon", "B Horizon")) +
  labs(tag = "(c)",
       x = "log(Ammonium Oxalate Extractable Al (g/100g))",
       y = "log(Cumul. Spec. Resp. (% SOC Respired))") +
  theme_bw() +
  theme(legend.title = element_text(face = "bold", size = axis_label_font_size),
        legend.text = element_text(color = "black", size = axis_font_size),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        plot.title = element_text(face = "bold", size = title_font_size),
        axis.title.x = element_text(face = "bold", size = axis_label_font_size),
        axis.title.y = element_text(face = "bold", size = axis_label_font_size),
        axis.text.x = element_text(color = "black", size = axis_font_size),
        axis.text.y = element_text(color = "black", size = axis_font_size),
        legend.margin = margin(0, 24, 0, 24),
        aspect.ratio = 1)

DC_Al_plot <- ggplot() +
  geom_point(data = data_lm_A, aes(x = log(DC_Al.g100g), y = log(CSR_52wks_pct), color = "1"), size = 3) +
  geom_point(data = data_lm_B, aes(x = log(DC_Al.g100g), y = log(CSR_52wks_pct), color = "2"), size = 3) +
  geom_smooth(method = "lm", formula = y ~ x, data = data_lm_A, aes(x = log(DC_Al.g100g), y = log(CSR_52wks_pct), color = "1")) +
  geom_smooth(method = "lm", formula = y ~ x, data = data_lm_B, aes(x = log(DC_Al.g100g), y = log(CSR_52wks_pct), color = "2")) +
  annotate("text", x = -4, y = 1, label = paste0("'A Hor.:'~ R ^ 2 ~'='~", round(summary(DC_Al_lm_A)$r.squared, 2)), size = R2_font_size, hjust = 0, parse = TRUE) +
  annotate("text", x = -4, y = 0.8, label = paste0("'B Hor.:'~ R ^ 2 ~'='~", round(summary(DC_Al_lm_B)$r.squared, 2)), size = R2_font_size, hjust = 0, parse = TRUE) +
  scale_color_manual(name = "Horizon Type", values = gg_colors, labels = c("A Horizon", "B Horizon")) +
  labs(tag = "(d)",
       x = "log(Dithionite-Citrate Extractable Al (g/100g))",
       y = "log(Cumul. Spec. Resp. (% SOC Respired))") +
  theme_bw() +
  theme(legend.title = element_text(face = "bold", size = axis_label_font_size),
        legend.text = element_text(color = "black", size = axis_font_size),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        plot.title = element_text(face = "bold", size = title_font_size),
        axis.title.x = element_text(face = "bold", size = axis_label_font_size),
        axis.title.y = element_text(face = "bold", size = axis_label_font_size),
        axis.text.x = element_text(color = "black", size = axis_font_size),
        axis.text.y = element_text(color = "black", size = axis_font_size),
        legend.margin = margin(0, 24, 0, 24),
        aspect.ratio = 1)

ggarrange(SP_Fe_plot,
          AO_Fe_plot,
          AO_Al_plot,
          DC_Al_plot,
          ncol = 2,
          nrow = 2,
          align = "hv",
          common.legend = TRUE,
          legend = "right")
